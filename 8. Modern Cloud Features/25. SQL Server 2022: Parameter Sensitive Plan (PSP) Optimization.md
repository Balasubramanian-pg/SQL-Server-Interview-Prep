# 25. SQL Server 2022: Parameter Sensitive Plan (PSP) Optimization

Canonical documentation for 25. SQL Server 2022: Parameter Sensitive Plan (PSP) Optimization. This document defines the conceptual model, terminology, and standard usage patterns.

> [!NOTE]
> This documentation is implementation-agnostic and intended to serve as a stable reference.

## 1. Purpose and Problem Space
Describe why 25. SQL Server 2022: Parameter Sensitive Plan (PSP) Optimization exists and the class of problems it addresses.
The primary purpose of Parameter Sensitive Plan (PSP) Optimization in SQL Server 2022 is to address the issue of parameter sniffing, which can lead to suboptimal query performance. Parameter sniffing occurs when the query optimizer uses the parameters provided during the initial execution of a query to generate an execution plan, which may not be optimal for subsequent executions with different parameter values. PSP Optimization aims to improve the performance of queries by adapting the execution plan based on the actual parameter values, thereby reducing the impact of parameter sniffing.

## 2. Conceptual Overview
Provide a high-level mental model of the topic.
The conceptual overview of PSP Optimization involves the query optimizer analyzing the query and determining the optimal execution plan based on the provided parameters. The optimizer considers various factors, including the query syntax, data distribution, and system resources, to generate an efficient plan. With PSP Optimization, the optimizer can adjust the plan based on the actual parameter values, ensuring that the execution plan is tailored to the specific use case.

## 3. Terminology and Definitions
| Term | Definition |
|------|------------|
| Parameter Sniffing | The process of using the parameters provided during the initial execution of a query to generate an execution plan. |
| Parameter Sensitive Plan (PSP) | An execution plan that is adapted based on the actual parameter values. |
| Query Optimizer | The component responsible for analyzing queries and generating efficient execution plans. |
| Execution Plan | A sequence of operations used to execute a query. |
| Cardinality Estimation | The process of estimating the number of rows that will be returned by a query. |

## 4. Core Concepts
Explain the fundamental ideas that form the basis of this topic.
The core concepts of PSP Optimization include:
* **Parameter sensitivity**: The ability of the query optimizer to adapt the execution plan based on the actual parameter values.
* **Cardinality estimation**: The process of estimating the number of rows that will be returned by a query, which is crucial in determining the optimal execution plan.
* **Plan caching**: The mechanism of storing and reusing execution plans to improve query performance.
* **Query optimization**: The process of analyzing queries and generating efficient execution plans.

## 5. Standard Model
Describe the generally accepted or recommended model.
The standard model for PSP Optimization involves the following steps:
1. **Query analysis**: The query optimizer analyzes the query and determines the optimal execution plan based on the provided parameters.
2. **Parameter sensitivity analysis**: The optimizer analyzes the query to determine the sensitivity of the execution plan to the provided parameters.
3. **Plan adaptation**: The optimizer adapts the execution plan based on the actual parameter values.
4. **Plan caching**: The adapted plan is stored in the plan cache for future use.

## 6. Common Patterns
Document recurring, accepted patterns.
Common patterns for PSP Optimization include:
* **Using stored procedures**: Stored procedures can help reduce the impact of parameter sniffing by providing a fixed execution plan.
* **Using query hints**: Query hints can be used to influence the query optimizer's decision-making process.
* **Using plan guides**: Plan guides can be used to specify the desired execution plan for a query.

## 7. Anti-Patterns
Describe common but discouraged practices.
Anti-patterns for PSP Optimization include:
* **Over-reliance on query hints**: Over-reliance on query hints can lead to suboptimal performance and make the system more difficult to maintain.
* **Ignoring parameter sensitivity**: Ignoring parameter sensitivity can lead to suboptimal execution plans and reduced query performance.
* **Not monitoring query performance**: Not monitoring query performance can make it difficult to identify and address issues related to PSP Optimization.

## 8. References
Provide exactly five authoritative external references.
1. [Microsoft Documentation: Parameter Sensitive Plan Optimization](https://docs.microsoft.com/en-us/sql/relational-databases/performance/parameter-sensitive-plan-optimization?view=sql-server-ver15)
2. [SQL Server Blog: Parameter Sensitive Plan Optimization in SQL Server 2022](https://cloudblogs.microsoft.com/sqlserver/2022/02/14/parameter-sensitive-plan-optimization-in-sql-server-2022/)
3. [SQL Server Performance Blog: Understanding Parameter Sniffing](https://www.sqlserverperformance.blog/2020/02/14/understanding-parameter-sniffing/)
4. [DBA Stack Exchange: Parameter Sensitive Plan Optimization](https://dba.stackexchange.com/questions/311129/parameter-sensitive-plan-optimization)
5. [Microsoft Tech Community: Optimizing Query Performance with Parameter Sensitive Plan Optimization](https://techcommunity.microsoft.com/t5/sql-server/optimizing-query-performance-with-parameter-sensitive-plan/ba-p/2141425)

## 9. Change Log
| Version | Date | Description |
|---------|------|-------------|
| 1.0 | 2026-02-14 | Initial documentation |