# 14. ACID Properties Implementation

Canonical documentation for [14. ACID Properties Implementation](1. Database Architecture Internals/14. ACID Properties Implementation.md). This document defines concepts, terminology, and standard usage.

## Purpose
The ACID properties (Atomicity, Consistency, Isolation, Durability) exist to provide a guarantee of reliability and data integrity within a database management system (DBMS). In any environment where multiple processes access shared data or where hardware and software failures are possible, the ACID model provides a framework for ensuring that transactions—logical units of work—are processed reliably. This topic addresses the implementation strategies required to maintain a "Single Source of Truth" even under adverse conditions.

> [!NOTE]
> This documentation is intended to be implementation-agnostic and authoritative, focusing on the architectural requirements rather than specific vendor syntax.

## Scope
This document covers the theoretical requirements and the structural mechanisms used to enforce ACID properties in transactional systems.

> [!IMPORTANT]
> **In scope:**
> * Core functionality of the four ACID pillars.
> * Theoretical boundaries of transactional integrity.
> * Mechanisms such as Write-Ahead Logging (WAL) and Concurrency Control.

> [!WARNING]
> **Out of scope:**
> * Specific vendor implementations (e.g., specific MySQL or Oracle configurations).
> * NoSQL "BASE" consistency models (except for contrast).
> * Hardware-level storage optimization.

## Definitions
| Term | Definition |
|------|------------|
| Transaction | A logical unit of work that performs one or more operations against a database. |
| Commit | The operation that signals the successful completion of a transaction, making changes permanent. |
| Rollback | The operation that aborts a transaction and reverts all changes made during its execution. |
| Write-Ahead Log (WAL) | A family of techniques for providing atomicity and durability by logging changes to a stable storage before applying them to the database. |
| Isolation Level | The degree to which the operations in one transaction are visible to other concurrent transactions. |
| Invariant | A condition or rule that must always remain true for the data to be considered valid. |

## Core Concepts

### Atomicity: The "All or Nothing" Principle
Atomicity ensures that a transaction is treated as a single, indivisible unit. Either all of its operations are executed, or none of them are. If any part of the transaction fails, the entire transaction is aborted, and the database is left unchanged.

### Consistency: The "Valid State" Principle
Consistency ensures that a transaction brings the database from one valid state to another, maintaining all predefined rules, including constraints, cascades, and triggers. It is the responsibility of both the system (to enforce constraints) and the application developer (to define logical invariants).

### Isolation: The "Independence" Principle
Isolation ensures that the concurrent execution of transactions results in a system state that would be obtained if transactions were executed serially. This prevents transactions from seeing intermediate, uncommitted data from other transactions.

### Durability: The "Permanence" Principle
Durability guarantees that once a transaction has been committed, it will remain committed even in the event of a system failure (e.g., power outage or crash). This is typically achieved by recording the transaction's effects in non-volatile memory.

> [!TIP]
> Think of ACID as a contract: the user promises to group related operations into a transaction, and the system promises that these operations will never be partially applied or lost once confirmed.

## Standard Model
The standard model for ACID implementation relies on a Transaction Manager that coordinates with a Resource Manager.

1.  **The Transaction Lifecycle:** A transaction begins, performs a series of read/write operations, and concludes with either a `COMMIT` or a `ROLLBACK`.
2.  **Recovery Management:** To ensure Atomicity and Durability, systems implement a recovery manager using **Write-Ahead Logging (WAL)**. Before any data is modified on disk, a log record describing the change is flushed to stable storage.
3.  **Concurrency Control:** To ensure Isolation, systems use either **Locking** (Pessimistic) or **Multiversion Concurrency Control (MVCC)** (Optimistic). MVCC allows multiple versions of a data item to exist simultaneously, enabling readers to access data without blocking writers.

## Common Patterns

### Write-Ahead Logging (WAL)
The most prevalent pattern for ensuring Durability and Atomicity. By appending changes to a sequential log before updating the actual data files, the system can "replay" the log after a crash to restore the database to its last consistent state.

### Two-Phase Commit (2PC)
A pattern used in distributed systems to ensure ACID properties across multiple nodes. It involves a "Prepare" phase (where all nodes vote on whether they can commit) and a "Commit" phase (where the coordinator instructs all nodes to finalize the change).

### Snapshot Isolation
A common implementation of the Isolation property where a transaction sees a "snapshot" of the data as it existed at the start of the transaction. This avoids many common concurrency anomalies while maintaining high performance.

## Anti-Patterns

### Long-Running Transactions
Holding a transaction open for an extended period (e.g., waiting for user input) leads to excessive locking and resource exhaustion, effectively breaking the system's ability to provide Isolation and Availability.

### Manual State Management
Attempting to implement "undo" logic within the application layer instead of relying on the database's `ROLLBACK` mechanism. This often leads to "Partial Success" scenarios where the application state and database state diverge.

> [!CAUTION]
> Avoid performing non-database side effects (like sending an email or calling an external API) inside a database transaction. If the transaction rolls back, the side effect cannot be undone, violating the Atomicity principle from the user's perspective.

## Edge Cases

### System Crash During Commit
A critical edge case occurs when the system fails exactly between the log flush and the final acknowledgment to the user. Implementation must ensure that upon restart, the recovery manager can determine if the transaction was truly committed based on the presence of a "Commit Record" in the log.

### Deadlocks
In systems using strict locking for Isolation, two transactions may end up waiting for each other to release locks. The implementation must include a deadlock detection mechanism that identifies the cycle and terminates one of the transactions.

### Clock Skew in Distributed ACID
In distributed environments, "Consistency" and "Isolation" often rely on timestamps. If the clocks on different servers are not synchronized, the system may incorrectly order transactions, leading to a violation of the Serializability requirement.

## Related Topics
*   **15. Concurrency Control Mechanisms:** Detailed exploration of Locking vs. MVCC.
*   **16. Distributed Transactions:** Implementation of ACID across networked nodes.
*   **CAP Theorem:** The trade-offs between Consistency, Availability, and Partition Tolerance in distributed systems.

## Change Log
| Version | Date | Description |
|---------|------|-------------|
| 1.0 | 2026-02-11 | Initial AI-generated canonical documentation |