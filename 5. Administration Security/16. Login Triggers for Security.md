# 16. Login Triggers for Security

Canonical documentation for [16. Login Triggers for Security](5. Administration Security/16. Login Triggers for Security.md). This document defines concepts, terminology, and standard usage.

## Purpose
Login triggers exist to provide a programmable interface for intercepting and evaluating authentication events. They address the need for dynamic security enforcement that cannot be achieved through static configuration alone. By executing logic at the moment of access, organizations can enforce complex compliance rules, perform real-time risk assessment, and maintain granular audit trails of all entry attempts into a system.

> [!NOTE]
> This documentation is intended to be implementation-agnostic and authoritative, focusing on the architectural role of triggers rather than specific database or application syntax.

## Scope
This documentation covers the theoretical framework, execution timing, and security implications of triggers associated with the authentication lifecycle.

> [!IMPORTANT]
> **In scope:**
> * Event-driven security logic (Pre- and Post-authentication).
> * Session context validation and modification.
> * Failure handling and exception propagation during the login sequence.
> * Auditing and telemetry generation.

> [!WARNING]
> **Out of scope:**
> * Specific vendor implementations (e.g., SQL Server `LOGON` triggers, Oracle `AFTER LOGON` triggers).
> * General database DML/DDL triggers.
> * User interface design for login screens.

## Definitions
| Term | Definition |
|------|------------|
| Login Trigger | A procedural code block or function automatically executed in response to an authentication event. |
| Pre-Authentication Trigger | A trigger that executes before the system validates credentials, often used for IP filtering or rate limiting. |
| Post-Authentication Trigger | A trigger that executes after credentials are validated but before the session is fully established. |
| Session Context | The set of attributes and metadata associated with a specific user connection (e.g., IP address, application name, time of day). |
| Interceptor | A mechanism that halts the login process based on logic defined within the trigger. |
| Rollback (Login) | The act of terminating a connection attempt and reverting any session changes due to a trigger-detected security violation. |

## Core Concepts
Login triggers function as "gatekeepers" within the authentication pipeline. They operate on the principle of event-driven security, where the act of logging in is the event that fires the security logic.

**1. Execution Timing**
Triggers typically fire in two phases:
*   **Validation Phase:** Checking if the connection should even be attempted (e.g., checking a blacklist).
*   **Establishment Phase:** Setting up the environment for a successful login (e.g., setting session variables or logging the entry).

**2. Synchronous Execution**
Security triggers are almost always synchronous. The login process waits for the trigger to complete. If the trigger fails or explicitly denies access, the login attempt is rejected.

> [!TIP]
> Think of a login trigger as a security guard at a gate. The guard doesn't just check your ID (the password); they also check if you are wearing the proper safety gear (compliance) and record your arrival time in a logbook (auditing) before letting you through.

## Standard Model
The standard model for login triggers follows a linear execution path within the authentication service:

1.  **Connection Request:** The client initiates a connection.
2.  **Pre-Auth Evaluation:** The system checks environmental factors (IP, Time, Protocol).
3.  **Credential Verification:** The system validates the identity (Password, MFA, Token).
4.  **Post-Auth Trigger Execution:**
    *   The trigger retrieves session context.
    *   The trigger executes business logic (e.g., "Is this user allowed to log in from this specific workstation?").
    *   The trigger performs side effects (e.g., updating the `last_login` timestamp).
5.  **Final Disposition:**
    *   **Success:** The session is granted.
    *   **Failure:** The trigger raises an exception, the session is killed, and an error is returned to the client.

## Common Patterns
*   **Geofencing/IP Filtering:** Restricting logins to specific CIDR blocks or geographic regions regardless of credential validity.
*   **Concurrent Session Limiting:** Checking a session table to ensure a single user identity does not exceed a maximum number of active connections.
*   **Time-of-Day Restrictions:** Preventing administrative access outside of standard business hours or change windows.
*   **Environment Initialization:** Automatically setting session-level security parameters (e.g., Row-Level Security context) immediately upon login.

## Anti-Patterns
*   **Heavy Computational Logic:** Performing complex calculations or long-running queries inside a trigger, which increases login latency and can lead to Denial of Service (DoS).
*   **Recursive Triggers:** Designing a trigger that performs an action which re-triggers itself, leading to stack overflows or system hangs.
*   **Inadequate Error Handling:** Failing to account for what happens if the trigger itself encounters an error (e.g., a logging table is full).
*   **Direct User Interaction:** Attempting to prompt the user for input from within a background trigger, which usually results in a hung process.

> [!CAUTION]
> Avoid circular dependencies where the trigger requires access to a resource that is locked or unavailable until the login is complete. This can result in a "deadlock" where no one, including administrators, can log in.

## Edge Cases
*   **Administrative Lockout:** If a login trigger contains a bug, it may prevent all users, including administrators, from accessing the system. Most systems provide a "diagnostic" or "minimal" mode to bypass triggers in emergencies.
*   **Service Accounts:** Automated processes or service accounts may fail if a trigger expects interactive metadata (like a browser user-agent) that the service account does not provide.
*   **Connection Pooling:** In environments using connection pools, triggers may fire only when the pool creates a new connection, not when a user "borrows" an existing one from the pool, leading to inconsistent security enforcement.

## Related Topics
*   **Multi-Factor Authentication (MFA):** Triggers often act as the logic layer that determines if an MFA challenge is required.
*   **Audit Logging:** Triggers are a primary source of high-fidelity audit data for compliance (e.g., SOC2, HIPAA).
*   **Identity and Access Management (IAM):** Triggers extend IAM policies by adding runtime context to static permissions.

## Change Log
| Version | Date | Description |
|---------|------|-------------|
| 1.0 | 2026-02-13 | Initial AI-generated canonical documentation |