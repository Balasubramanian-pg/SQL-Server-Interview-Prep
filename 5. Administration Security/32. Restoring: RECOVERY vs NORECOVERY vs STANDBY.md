# 32. Restoring: RECOVERY vs NORECOVERY vs STANDBY

Canonical documentation for [32. Restoring: RECOVERY vs NORECOVERY vs STANDBY](5. Administration Security/32. Restoring: RECOVERY vs NORECOVERY vs STANDBY.md). This document defines concepts, terminology, and standard usage.

## Purpose
The purpose of defining restoration states is to manage the lifecycle of a database during the transition from backup media to an active, consistent operational state. In complex data environments, restoration is rarely a single-step event. Administrators often need to apply multiple backup sets (full, differential, and incremental/transactional) in a specific sequence. 

These states—RECOVERY, NORECOVERY, and STANDBY—control whether the database engine performs "roll-forward" and "roll-back" operations, and whether the database remains accessible to users during the restoration process. They provide the mechanism to maintain transactional integrity while allowing for the sequential application of data updates.

> [!NOTE]
> This documentation is intended to be implementation-agnostic and authoritative, focusing on the logical behavior of database engines during restoration sequences.

## Scope
This document covers the theoretical and functional boundaries of database restoration states.

> [!IMPORTANT]
> **In scope:**
> * The transition of database states during multi-step restoration.
> * The behavior of the transaction log during different restoration phases.
> * Read-only accessibility vs. write-only restoration modes.
> * Transactional consistency requirements (Undo/Redo phases).

> [!WARNING]
> **Out of scope:**
> * Specific vendor-specific command syntax (e.g., T-SQL, PL/SQL).
> * Hardware-level snapshot restoration.
> * Cloud-provider-specific "point-in-time" GUI abstractions.

## Definitions
| Term | Definition |
|------|------------|
| Roll-Forward (Redo) | The process of applying committed transactions from a backup to the data files. |
| Roll-Back (Undo) | The process of reversing uncommitted transactions to ensure the database is in a consistent state. |
| Restoration Chain | The ordered sequence of backups (Full -> Differential -> Log) required to reach a specific point in time. |
| Consistent State | A state where all committed transactions are reflected in the data and no uncommitted transactions remain. |
| Undo File | A temporary file used in STANDBY mode to store data displaced by the roll-back of uncommitted transactions, allowing for subsequent log application. |

## Core Concepts
The fundamental concept underlying restoration states is the management of the **Recovery Interval**. When a database is restored, the system must decide when to finalize the data.

### The Two-Phase Recovery Process
1.  **Redo Phase:** The engine applies all transactions found in the backup. This brings the data up to the point where the backup ended.
2.  **Undo Phase:** The engine identifies transactions that were in progress but not committed when the backup finished. It reverses these to ensure data integrity.

### State Transitions
*   **NORECOVERY** halts the process after the Redo phase but before the Undo phase. This keeps the "door open" for more data.
*   **RECOVERY** completes both phases, bringing the database online but "closing the door" to further backup applications.
*   **STANDBY** performs a temporary Undo phase to allow read-only access, while keeping the "door open" to revert the Undo and apply more data later.

> [!TIP]
> Think of NORECOVERY as a construction site that is still receiving materials. RECOVERY is the finished building with the "Open" sign turned on. STANDBY is a building that allows tours but requires the workers to move their tools back in before construction can resume.

## Standard Model
The standard model for restoration follows a linear progression to ensure data integrity and minimize downtime.

1.  **Initial Restore (NORECOVERY):** The full backup is applied. The database is in a "Restoring" state. It is not readable or writable.
2.  **Intermediate Restores (NORECOVERY):** Differential and sequential transaction log backups are applied. The database remains in the "Restoring" state.
3.  **Final Restore (RECOVERY):** The last transaction log is applied. The engine performs the Undo phase, rolls back uncommitted transactions, and brings the database online for general use.

> [!IMPORTANT]
> Once a database is transitioned to the RECOVERY state, the restoration chain is broken. No further logs from the original sequence can be applied because the database has diverged from the backup timeline.

## Common Patterns

### Log Shipping / Warm Standby
In this pattern, a secondary database is kept in a perpetual NORECOVERY or STANDBY state. Transaction logs from a primary database are periodically applied to the secondary. If STANDBY is used, the secondary can serve as a read-only reporting server between log applications.

### Point-in-Time Recovery
When a database must be recovered to a specific second (e.g., just before a catastrophic user error), the administrator restores the full backup and all subsequent logs using NORECOVERY, applying the final log with a specific timestamp or Log Sequence Number (LSN) and the RECOVERY keyword.

### Disaster Recovery Validation
Administrators use STANDBY to periodically bring a DR site into a readable state to verify that the data being replicated is valid and consistent without breaking the replication chain.

## Anti-Patterns

### Premature Recovery
Executing a restore with the RECOVERY state before all available logs have been applied. This forces the administrator to restart the entire restoration process from the full backup if additional data is needed.

### Skipping the Log Chain
Attempting to restore a log backup without having applied all preceding logs in the chain. This results in an inconsistent state and restoration failure.

### Over-reliance on STANDBY for High-Traffic Reporting
Using STANDBY for heavy reporting while simultaneously trying to maintain a frequent log-application schedule. The process of switching between "Read-Only" and "Restoring" can cause significant overhead and lock contention.

> [!CAUTION]
> Do not delete the "Undo" file created during a STANDBY restore. If this file is lost or corrupted, the database cannot transition back to a restoring state to accept further logs, effectively breaking the restoration chain.

## Edge Cases

### Tail-Log Backups
In a failure scenario where the data files are lost but the active log file is intact, a "tail-log" backup must be taken. This log must be the final piece of the restoration chain applied with RECOVERY.

### Read-Only Databases
If a database is restored from a read-only media or into a read-only state, the RECOVERY process may behave differently regarding the Undo phase, as it cannot write the changes necessary to roll back transactions unless a writable location for the Undo file is provided.

### Interrupted Restoration
If a restoration process is interrupted (e.g., power failure) while in NORECOVERY, the database typically remains in the "Restoring" state and can resume once the service is restored, provided the backup media is still accessible.

## Related Topics
*   **Transaction Log Management:** The underlying architecture that enables these states.
*   **Backup Types (Full, Differential, Incremental):** The data sources for the restoration process.
*   **Log Sequence Numbers (LSN):** The markers used to ensure logs are applied in the correct order.
*   **Database Snapshots:** An alternative method for providing read-only access to data at a specific point in time.

## Change Log
| Version | Date | Description |
|---------|------|-------------|
| 1.0 | 2026-02-13 | Initial AI-generated canonical documentation |