# 15. SQL Server Audit (Server vs Database Specs)

Canonical documentation for [15. SQL Server Audit (Server vs Database Specs)](5. Administration Security/15. SQL Server Audit (Server vs Database Specs).md). This document defines concepts, terminology, and standard usage.

## Purpose
The SQL Server Audit framework provides a structured mechanism for tracking and logging events that occur within the database engine. Its primary purpose is to ensure accountability, support regulatory compliance (such as GDPR, HIPAA, or PCI-DSS), and facilitate security forensics. By separating the "what is being audited" from "where the logs are stored," the framework allows for centralized management of security policies across an instance.

> [!NOTE]
> This documentation is intended to be implementation-agnostic regarding specific SQL Server versions and authoritative regarding the architectural relationship between server-level and database-level auditing.

## Scope
This documentation covers the logical architecture of the SQL Server Audit feature, specifically focusing on the distinction between Server Audit Specifications and Database Audit Specifications.

> [!IMPORTANT]
> **In scope:**
> * The hierarchical relationship between Audit objects and Audit Specifications.
> * The functional boundaries of Server-level vs. Database-level auditing.
> * Target destinations for audit telemetry.
> * The lifecycle of an audit event from capture to persistence.

> [!WARNING]
> **Out of scope:**
> * Third-party auditing extensions or external log aggregators.
> * Specific T-SQL syntax for every possible audit action.
> * Performance benchmarking for specific hardware configurations.

## Definitions
| Term | Definition |
|------|------------|
| SQL Server Audit | The parent object that resides at the Server level. It defines the destination (target) for audit records. |
| Server Audit Specification | A collection of server-level audit action groups that are collected by the SQL Server Audit object. |
| Database Audit Specification | A collection of database-level audit actions or action groups collected by the SQL Server Audit object. |
| Audit Target | The final destination of the audit logs, such as a file, the Windows Security event log, or the Windows Application event log. |
| Audit Action Group | A pre-defined collection of related atomic actions (e.g., `SUCCESSFUL_LOGIN_GROUP`). |
| Audit Action | An individual atomic operation that can be audited at the database level (e.g., `SELECT`, `UPDATE`). |

## Core Concepts
The SQL Server Audit architecture is built on a "one-to-many" relationship model. A single **SQL Server Audit** object acts as the central sink for multiple specifications.

### The Three-Tier Hierarchy
1.  **The Audit Object:** This is the "Bucket." It exists at the instance level and defines *where* the data goes (e.g., a file path). It does not know *what* is being audited; it only knows how to handle the incoming stream of data.
2.  **The Specification:** This is the "Filter." It defines *what* events are captured. Specifications are linked to exactly one Audit Object.
3.  **The Target:** This is the "Storage." It is the physical manifestation of the audit data (the `.sqlaudit` file or Event Log entry).

> [!TIP]
> Think of the **Audit Object** as a physical DVR system and the **Specifications** as the individual cameras. You can have cameras in the hallway (Server level) and cameras inside specific rooms (Database level), but they all feed back to the same DVR for recording.

## Standard Model
The standard model for auditing requires the activation of both the Audit Object and at least one Specification.

### Server Audit Specifications
These capture actions that occur at the instance level. They are global and apply to all databases on the instance or to the instance itself.
*   **Scope:** Logins, logouts, role changes, backup/restore operations, and changes to server-level permissions.
*   **Context:** These events are independent of any specific user database.

### Database Audit Specifications
These capture actions that occur within a specific database.
*   **Scope:** Data Manipulation Language (DML) operations (SELECT, INSERT, UPDATE, DELETE), Data Definition Language (DDL) operations within the database, and execution of stored procedures.
*   **Context:** These are granular and can be filtered by specific users, objects, or schemas.

> [!IMPORTANT]
> While a Server Audit Specification exists only once per instance per Audit Object, a Database Audit Specification must be created within each individual database that requires monitoring.

## Common Patterns
*   **Centralized Logging:** Mapping multiple Database Audit Specifications from different databases to a single Server Audit object to consolidate logs into one file or event log stream.
*   **Privileged User Monitoring:** Creating a Server Audit Specification specifically to track `DBA` or `SysAdmin` activity, such as changes to logins or security configurations.
*   **Granular Object Auditing:** Using Database Audit Specifications to track access to highly sensitive tables (e.g., `HR.Salaries`) while ignoring non-sensitive data to reduce log volume.

## Anti-Patterns
*   **Auditing "All" Events:** Enabling every available audit action group. This leads to "Audit Fatigue," where the volume of data makes it impossible to find meaningful security events, and can cause significant I/O overhead.
*   **Logging to the Primary Data Drive:** Storing audit files on the same physical disk as the database data or log files. This creates I/O contention and risks losing the audit trail if the data drive fails.
*   **Synchronous Audit Failure Ignoring:** Configuring the audit to "Continue" on failure in high-security environments. 

> [!CAUTION]
> If the audit target becomes unavailable (e.g., disk is full), and the audit is configured to "Fail Operation," the entire database instance may shut down to prevent unaudited actions. Choose the "On Failure" action carefully based on your compliance requirements.

## Edge Cases
*   **Contained Databases:** In a contained database model, certain user actions that would normally be server-level (like authentication) may be captured differently within the database context.
*   **Read-Only Databases:** Database Audit Specifications cannot be modified or enabled/disabled if the database is in `READ_ONLY` mode.
*   **Database Mirroring/Availability Groups:** Audit specifications are metadata within the database. While the specification replicates to the secondary, the **Server Audit Object** (the "Bucket") does not. It must be manually created on the secondary instance for auditing to function after a failover.

## Related Topics
*   **SQL Server Extended Events (XEvents):** A general-purpose event handling system that Audit is built upon.
*   **Change Data Capture (CDC):** Used for tracking data changes for ETL purposes rather than security/compliance.
*   **Temporal Tables:** Used for maintaining a history of data states rather than a history of "who accessed what."

## Change Log
| Version | Date | Description |
|---------|------|-------------|
| 1.0 | 2026-02-13 | Initial AI-generated canonical documentation |