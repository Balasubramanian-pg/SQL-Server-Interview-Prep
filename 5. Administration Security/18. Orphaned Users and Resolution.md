# 18. Orphaned Users and Resolution

Canonical documentation for [18. Orphaned Users and Resolution](5. Administration Security/18. Orphaned Users and Resolution.md). This document defines concepts, terminology, and standard usage.

## Purpose
The concept of orphaned users addresses the misalignment between an identity provider (authentication) and a downstream resource (authorization). This problem space exists because systems often decouple the mechanism that proves *who* a person is from the mechanism that defines *what* that person can access within a specific environment.

When the link between these two layers is severed—due to migrations, restorations, or administrative errors—the resource-level user record remains, but it is no longer associated with a valid, authenticated identity. This documentation establishes the framework for identifying, managing, and resolving these discrepancies to maintain system integrity and security.

> [!NOTE]
> This documentation is intended to be implementation-agnostic and authoritative.

## Scope
Clarify what is in scope and out of scope for this topic.

> [!IMPORTANT]
> **In scope:**
> * The logical state of orphaned accounts in multi-tiered architectures.
> * Theoretical frameworks for identity-to-user mapping.
> * Security implications of unlinked authorization records.
> * General strategies for reconciliation and remediation.

> [!WARNING]
> **Out of scope:**
> * Specific vendor-specific syntax or command-line tools.
> * Troubleshooting specific database engine errors.
> * Physical hardware failures leading to data corruption.

## Definitions
Provide precise definitions for key terms.

| Term | Definition |
|------|------------|
| Identity (Login) | The global or system-wide entity used for authentication (e.g., a record in an IdP or a server-level login). |
| User (Principal) | The local or resource-specific entity used for authorization (e.g., a record within a specific database or application). |
| Orphaned User | A user record that lacks a corresponding, valid identity record, rendering the account inaccessible but still present in the access control list (ACL). |
| Security Identifier (SID) | A unique value used to link an identity to a user record. |
| Reconciliation | The process of re-establishing the link between an identity and an orphaned user. |
| Remapping | The act of pointing an orphaned user record to a different or newly created identity. |

## Core Concepts
The fundamental challenge of orphaned users stems from the **Decoupled Identity Model**. In this model, the authentication layer (the "Login") and the authorization layer (the "User") are connected by a unique pointer, often a GUID or SID.

If a resource (such as a database or file system) is moved to a different environment, the local "User" records travel with the resource, but the global "Login" records do not. This creates a "Dangling Reference" where the resource expects a specific identifier that does not exist in the new environment's identity provider.

> [!TIP]
> Think of an identity as a passport and a user record as a specific visa. If you get a new passport (new identity), your old visa (user record) may still exist in a government database, but it is "orphaned" because it is tied to a passport number that is no longer recognized or active.

## Standard Model
The standard model for managing user-identity relationships follows a three-stage lifecycle:

1.  **Provisioning:** An identity is created in the central authority, and a corresponding user record is created in the local resource, linked by a common identifier.
2.  **Validation:** Upon access request, the system verifies that the authenticated identity matches the identifier stored in the local user record.
3.  **De-provisioning/Migration:** When an identity is removed or a resource is relocated, the link is broken. The "Standard Model" for resolution requires either the recreation of the identity with the matching identifier or the updating of the user record to point to a new valid identifier.

## Common Patterns
*   **Auto-Reconciliation by Name:** The system attempts to match orphaned users to identities based on a secondary attribute, such as a username or email address, rather than the primary SID.
*   **Manual Mapping:** An administrator explicitly updates the resource-level metadata to link an orphaned user to an existing identity.
*   **Tombstoning:** Instead of deleting orphaned users, the system marks them as "Inactive" or "Orphaned" to preserve audit trails while preventing access.
*   **Identity Injection:** Creating a new identity record that specifically mimics the identifier (SID) expected by the orphaned user record.

## Anti-Patterns
*   **Blind Deletion:** Deleting orphaned users without checking for object ownership. This can lead to "broken" resources if the orphaned user owned critical schemas, files, or processes.
*   **Hard-coding Identifiers:** Relying on environment-specific IDs in application code, which guarantees orphans during any environment migration.
*   **Over-Privileged Reconciliation:** Using a high-level service account to "fix" orphans by granting them generic access rather than restoring their specific, granular permissions.

> [!CAUTION]
> Avoid circular dependencies where the tool used to resolve orphaned users requires the orphaned user itself to have active permissions to run the resolution script.

## Edge Cases
*   **Renamed Identities:** If an identity is renamed in the provider but the SID remains the same, the user is not technically orphaned, but administrative confusion may occur.
*   **Cross-Domain Trust Failures:** In federated environments, a user may appear orphaned if the trust relationship between the resource domain and the identity domain is severed, even if both records are intact.
*   **Sid History:** In some directory migrations, an identity may possess multiple SIDs (a new one and a legacy one). A user record linked to the legacy SID may appear orphaned if the system does not support SID History lookups.
*   **Ownership Chains:** An orphaned user that owns a container (like a database schema) may prevent the deletion of that container, creating a "deadlock" in cleanup operations.

## Related Topics
*   **Identity and Access Management (IAM):** The broader framework for managing digital identities.
*   **Access Control Lists (ACL):** The mechanism by which user records define permissions.
*   **Principle of Least Privilege:** The security doctrine impacted by the presence of unmanaged orphaned accounts.
*   **Data Portability:** The challenges of moving data across security boundaries.

## Change Log

| Version | Date | Description |
|---------|------|-------------|
| 1.0 | 2026-02-13 | Initial AI-generated canonical documentation |