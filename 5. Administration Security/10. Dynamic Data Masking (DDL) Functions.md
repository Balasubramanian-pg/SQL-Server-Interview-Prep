# 10. Dynamic Data Masking (DDL) Functions

Canonical documentation for [10. Dynamic Data Masking (DDL) Functions](5. Administration Security/10. Dynamic Data Masking (DDL) Functions.md). This document defines concepts, terminology, and standard usage.

## Purpose
Dynamic Data Masking (DDM) functions exist to limit the exposure of sensitive data by obfuscating it in the result sets of queries. The primary problem space addressed is the "Least Privilege" principle regarding data visibility. DDM allows organizations to protect Personally Identifiable Information (PII), Protected Health Information (PHI), and other sensitive attributes from non-privileged users without modifying the underlying physical data or requiring changes to the application logic.

By defining masking logic at the Data Definition Language (DDL) level, security policies are centralized within the data layer, ensuring consistent enforcement across various access tools and interfaces.

> [!NOTE]
> This documentation is intended to be implementation-agnostic and authoritative.

## Scope
The scope of this document covers the theoretical framework and functional requirements for implementing masking at the schema level.

> [!IMPORTANT]
> **In scope:**
> * Functional categories of masking (Full, Partial, Random, etc.).
> * The relationship between DDL-defined masks and Role-Based Access Control (RBAC).
> * The non-destructive nature of dynamic transformations.
> * Metadata-driven security policies.

> [!WARNING]
> **Out of scope:**
> * Specific vendor implementations (e.g., T-SQL, PL/SQL, or cloud-native SQL dialects).
> * Static Data Masking (SDM), which permanently alters data at rest.
> * Encryption-at-rest or encryption-in-transit technologies.

## Definitions
| Term | Definition |
|------|------------|
| Masking Function | A deterministic or non-deterministic algorithm applied to a column to transform its output. |
| Cleartext | The original, unmasked data as it resides in physical storage. |
| Presentation Layer | The stage of query execution where data is formatted for the requesting client. |
| Redaction | A specific type of masking where the entire value is replaced by a constant or null value. |
| Inference Attack | An attempt to deduce masked data by observing query results, execution times, or error messages. |
| Unmask Permission | A specific administrative privilege that allows a user to bypass the masking function. |

## Core Concepts
Dynamic Data Masking operates as a security filter between the storage engine and the result set. Unlike encryption, which focuses on securing data against unauthorized physical access, DDM focuses on controlling visibility for authorized users who have access to the database but should not see specific data points.

The fundamental characteristic of DDM is that it is **non-destructive**. The data on the disk remains in its original format; the transformation occurs "on-the-fly" during the projection phase of a query.

> [!TIP]
> Think of Dynamic Data Masking like a "privacy glass" in a building. The person behind the glass (the data) remains unchanged, but the observer's view is blurred or obstructed based on their authorization level.

## Standard Model
The standard model for DDM functions involves three primary components:

1.  **The Masking Policy:** A set of rules defined in the DDL that associates specific columns with specific masking functions.
2.  **The Evaluation Engine:** A process that intercepts the query, identifies the user's privileges, and determines if the mask should be applied.
3.  **The Transformation Logic:** The actual function (e.g., `partial('XXX-XX-', 4)`) that modifies the data stream before it is sent to the client.

In this model, the masking is transparent to the application. The application sends a standard `SELECT` statement, and the database engine handles the obfuscation automatically based on the session context.

## Common Patterns
DDM functions generally fall into four recurring patterns:

*   **Default/Full Masking:** Replaces the entire value with a fixed constant based on the data type (e.g., `0` for integers, `XXXX` for strings, `1900-01-01` for dates).
*   **Partial Masking (Padding):** Exposes a small portion of the data (prefix or suffix) while masking the rest. This is common for credit card numbers or social security numbers.
*   **Email Masking:** A specialized partial mask that preserves the structure of an email address (e.g., `aXXX@domain.com`) to maintain application utility while hiding the identity.
*   **Random/Shuffling:** Replaces the actual value with a random value from a similar distribution, useful for testing environments where data characteristics must be preserved but actual values must be hidden.

## Anti-Patterns
*   **Masking as Primary Security:** Relying solely on DDM to secure a database. DDM is a supplementary control; it does not prevent data exfiltration by users with high-level administrative access.
*   **Masking Primary Keys or Join Keys:** Applying masks to columns used in joins or foreign key relationships. This can lead to incorrect query results or significant performance degradation.
*   **Over-Masking for Admins:** Applying masks to service accounts or DBAs who require cleartext access for maintenance, which can lead to "shadow" accounts being created to bypass restrictions.
*   **Inconsistent Masking:** Applying different masking logic to the same logical data element across different tables, allowing for cross-referencing and data de-anonymization.

> [!CAUTION]
> Avoid masking columns that are frequently used in `WHERE` clauses or `GROUP BY` statements. If the masking engine is not integrated deeply into the optimizer, it may cause full table scans or return logically inconsistent results.

## Edge Cases
*   **Type Casting:** If a masked string is cast to a different data type in a query, the masking function must be robust enough to handle the transformation without throwing errors or leaking data.
*   **Data Export (Bulk Copy):** Many DDM implementations apply masks during bulk export operations. If an administrator exports data to a CSV, the CSV will contain the masked values, potentially rendering the backup or migration useless.
*   **Subqueries and CTEs:** Masking must persist through Common Table Expressions (CTEs) and subqueries. If a user selects from a view that references a masked column, the mask must still be enforced.
*   **Inference via Aggregation:** A user might not see an individual's salary, but they might be able to calculate it by querying the `SUM()` of salaries for a department before and after a specific employee is hired.

## Related Topics
*   **Role-Based Access Control (RBAC):** The framework usually used to determine who sees masked vs. unmasked data.
*   **Static Data Masking (SDM):** The process of permanently altering data for non-production environments.
*   **Row-Level Security (RLS):** A complementary technology that restricts which *rows* a user can see, whereas DDM restricts which *columns* or *values* they can see.
*   **Data Sovereignty and Compliance:** The legal frameworks (GDPR, CCPA) that mandate the use of masking.

## Change Log
| Version | Date | Description |
|---------|------|-------------|
| 1.0 | 2026-02-13 | Initial AI-generated canonical documentation |