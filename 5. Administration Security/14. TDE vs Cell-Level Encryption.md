# 14. TDE vs Cell Level Encryption

Canonical documentation for 14. TDE vs Cell Level Encryption. This document defines concepts, terminology, and standard usage.

## Purpose
The purpose of this topic is to define the architectural distinctions between Transparent Data Encryption (TDE) and Cell-Level Encryption (CLE). It addresses the problem of securing data-at-rest by categorizing encryption methods based on their granularity, implementation layer, and the specific threats they are designed to mitigate.

> [!NOTE]
> This documentation is intended to be implementation-agnostic and authoritative, focusing on the theoretical and structural differences rather than specific database engine syntax.

## Scope
This documentation covers the conceptual framework of data-at-rest encryption within database systems.

> [!IMPORTANT]
> **In scope:**
> * Architectural boundaries of file-level vs. data-element encryption.
> * Impact on application logic and database performance.
> * Security boundary definitions (who is being blocked from seeing data).
> * Key management hierarchies.

> [!WARNING]
> **Out of scope:**
> * Specific vendor implementations (e.g., SQL Server, Oracle, PostgreSQL specific commands).
> * Encryption-in-transit (TLS/SSL).
> * Hardware-level disk encryption (SEDs).

## Definitions
| Term | Definition |
|------|------------|
| Transparent Data Encryption (TDE) | A technology that encrypts the entire database at the storage level (data and log files) without requiring changes to the application code. |
| Cell-Level Encryption (CLE) | A granular encryption method where specific data elements (columns or individual cells) are encrypted using distinct keys or certificates. |
| Data-at-Rest | Data that is physically stored on persistent storage media (HDD, SSD, Tape). |
| Encryption Hierarchy | The layered structure of keys (e.g., Service Master Key -> Database Master Key -> Certificates -> Symmetric Keys) used to secure data. |
| Decryption Latency | The computational overhead required to transform ciphertext back into plaintext during a read operation. |

## Core Concepts
The fundamental difference between TDE and CLE lies in the **granularity of protection** and the **transparency to the consumer**.

### 1. The Scope of Protection
TDE protects the "container." If a physical drive or a backup file is stolen, the data remains encrypted. However, once the database service is started and authenticated, the data is decrypted in memory for any authorized user or process.

CLE protects the "content." Even if the database service is running and a user has access to the table, they cannot see the plaintext data unless they also have explicit access to the specific cryptographic keys used for those cells.

### 2. Transparency vs. Complexity
TDE is "transparent" because the application layer does not need to know encryption exists. The database engine handles encryption during writes to disk and decryption during reads into memory.

CLE is "non-transparent." It typically requires changes to the application's DML (Data Manipulation Language) statements. The application must explicitly call encryption and decryption functions.

> [!TIP]
> Think of TDE as a locked building: once you are inside with a valid badge, you can see everything on the desks. Think of CLE as a locked safe inside that building: even if you are in the building, you still need a specific combination to see what is inside the safe.

## Standard Model
The standard model for implementing these technologies follows the principle of **Defense in Depth**.

1.  **Storage Layer (TDE):** Applied to satisfy broad regulatory requirements (e.g., PCI-DSS, HIPAA) and to protect against physical media theft or unauthorized backup restoration.
2.  **Data Layer (CLE):** Applied to highly sensitive fields (e.g., Social Security Numbers, Credit Card CVVs) to protect against high-privileged users, such as Database Administrators (DBAs), who might have access to the system but no "need to know" for specific data points.

## Common Patterns
*   **Compliance-First Pattern:** Implementing TDE across all production databases to meet "encryption at rest" checkboxes with zero impact on development timelines.
*   **Multi-Tenant Isolation:** Using CLE with different keys for different customers within the same table, ensuring that even a cross-tenant query leak would result in unreadable ciphertext.
*   **Hybrid Approach:** Using TDE for the entire database to protect the physical files, while layering CLE on specific columns containing PII (Personally Identifiable Information).

## Anti-Patterns
*   **CLE for All Columns:** Attempting to encrypt every column using Cell-Level Encryption. This leads to massive performance degradation and breaks indexing/searchability.
*   **Storing Keys with Data:** Keeping the decryption keys or certificates in the same unprotected storage as the encrypted data, effectively nullifying the security benefits.
*   **Ignoring TDE for "Performance":** Foregoing TDE due to fear of overhead (usually 3-5%) while leaving sensitive backups unencrypted.

> [!CAUTION]
> Avoid using CLE on columns that are frequently used in `JOIN` operations or `WHERE` clauses. Because the data is encrypted, the database engine cannot perform standard indexing or range scans, leading to full table scans and severe performance bottlenecks.

## Edge Cases
*   **Indexing Encrypted Cells:** In most CLE implementations, you cannot index the encrypted column effectively. Some systems allow "Deterministic Encryption" to enable lookups, but this reduces security by allowing pattern analysis (the same plaintext always results in the same ciphertext).
*   **Memory Dumps:** TDE decrypts data when it is loaded into the buffer pool (RAM). A memory dump of a server running TDE will contain plaintext data. CLE data remains encrypted in the buffer pool until the specific decryption function is called.
*   **Collation Conflicts:** Encrypting a column can sometimes interfere with database collations (sorting rules), especially if the encryption process converts the data type to `VARBINARY`.

## Related Topics
*   **Key Management Systems (KMS):** Centralized services for managing the lifecycle of encryption keys.
*   **Always Encrypted:** A specialized evolution of CLE where encryption/decryption happens on the client-side driver, ensuring the database engine never sees plaintext.
*   **Masking vs. Encryption:** Dynamic Data Masking obscures data for non-privileged users but does not encrypt the underlying storage.

## Change Log
| Version | Date | Description |
|---------|------|-------------|
| 1.0 | 2026-02-13 | Initial AI-generated canonical documentation |