# 18. PIVOT and UNPIVOT

### 1. The Anchor
* **One-Sentence Pitch:** PIVOT and UNPIVOT are relational operators used to rotate data between rows and columns, enabling the transformation of datasets between "long" formats optimized for storage and "wide" formats optimized for human-readable reporting.
* **Category:** Technical Skill / Data Engineering & SQL

### 2. The Mechanics
* **Key Detail A: The PIVOT Operation:** PIVOT transforms unique values from one column into multiple new columns in the output. This process requires three elements: the **Grouping Column** (what remains as rows), the **Spreading Column** (the values that become new headers), and an **Aggregate Function** (how to calculate the data filling the new cells, such as `SUM` or `AVG`).
* **Key Detail B: The UNPIVOT Operation:** UNPIVOT performs the inverse by rotating columns back into rows. It takes multiple columns and collapses them into two specific columns: one for the original column name (the "Attribute") and one for the data contained within those columns (the "Value").
* **The Logic:** These operations solve the structural mismatch between normalized database schemas and analytical requirements. While normalized "long" data is efficient for transactional integrity, "wide" data is necessary for matrix-style reporting, trend analysis, and feeding certain machine learning models that require features to be represented as individual columns.

> [!NOTE]
> While PIVOT and UNPIVOT are standard in many SQL dialects (T-SQL, Snowflake, Oracle), the specific syntax varies. In systems without these explicit keywords, the same result is achieved using `CASE WHEN` statements with aggregations for pivoting, and `UNION ALL` for unpivoting.

### 3. The Evidence
* **Context (CAR/STAR):** A retail client provided legacy inventory data in a "wide" format, where each warehouse location was a separate column. This structure prevented the data science team from performing aggregate trend analysis across the entire supply chain.
* **Action:** I utilized the `UNPIVOT` operator to normalize the dataset into a "long" format (Date, WarehouseID, StockLevel). Subsequently, I built a dynamic `PIVOT` view for the executive dashboard that allowed stakeholders to toggle between viewing stock by "Region" or "Product Category" as column headers.
* **Result:** This transformation reduced the complexity of downstream analytical queries by 60% and allowed the integration of previously siloed warehouse data into a unified Power BI dashboard.

> [!TIP]
> When using PIVOT in SQL Server or Snowflake, you must explicitly list the values to be pivoted. For dynamic datasets where values change frequently, consider using dynamic SQL to construct the PIVOT list at runtime.

### 4. The Interview "Pivot"
* **Triggers:** "How do you handle data reshaping for BI tools?", "What is the difference between wide and long data formats?", or "How would you generate a year-over-year comparison report from transactional logs?"
* **The Connection:** This topic proves I understand the lifecycle of data from its raw, normalized state to its final, consumable form. It demonstrates that I can manipulate data structures efficiently without relying on external tools like Excel, ensuring that data transformations are performant, reproducible, and scalable within the database layer.

> [!IMPORTANT]
> Always remember that UNPIVOT does not perfectly "undo" a PIVOT if the original PIVOT operation involved data aggregation. Once data is summed or averaged during a PIVOT, the individual granular records are lost and cannot be recovered via UNPIVOT.