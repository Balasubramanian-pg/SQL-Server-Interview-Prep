# 25. Handling NULLs: COALESCE vs ISNULL

### 1. The Anchor
* **One-Sentence Pitch:** COALESCE and ISNULL are SQL functions used to handle NULL values by providing fallback defaults, differing primarily in portability, argument count, and data type evaluation logic.
* **Category:** Technical Skill / Database Engineering

### 2. The Mechanics
* **Key Detail A: COALESCE (The ANSI Standard):** COALESCE is an ANSI SQL standard function that accepts two or more arguments and returns the first non-NULL value in the list. Because it is a standard, it is portable across SQL Server, PostgreSQL, MySQL, and Oracle. It evaluates arguments using data type precedence, meaning the resulting data type is the one with the highest precedence among the input expressions.
* **Key Detail B: ISNULL (The T-SQL Specific):** ISNULL is a proprietary T-SQL function (SQL Server) that accepts exactly two arguments. If the first argument is NULL, it returns the second. Crucially, ISNULL inherits the data type and length/precision of the **first** argument. If the replacement value is longer than the original column definition, the output will be truncated.
* **The Logic:** These functions solve the problem of "NULL Propagation," where any mathematical operation involving a NULL results in NULL (e.g., `10 + NULL = NULL`). By providing a default value (like 0 for integers or 'N/A' for strings), developers ensure data integrity in reports and calculations.

> [!IMPORTANT]
> While `ISNULL` is slightly faster in SQL Server due to its simplicity, `COALESCE` is generally preferred for its flexibility and cross-platform compatibility.

### 3. The Evidence
* **Context (CAR/STAR):** During a migration of a legacy financial reporting system, the "Total Compensation" field was frequently returning NULL because the `Bonus` column contained NULLs for employees who didn't receive one.
* **Action:** I audited the stored procedures and replaced direct additions with `COALESCE(BaseSalary, 0) + COALESCE(Bonus, 0)`. I also utilized `COALESCE` to provide a hierarchy of contact information: `COALESCE(BusinessEmail, PersonalEmail, 'No Email Provided')`.
* **Result:** This eliminated 100% of the "Missing Data" errors in the executive dashboard and ensured that the financial totals were mathematically accurate without requiring complex `CASE` statements.

> [!TIP]
> Be careful with `ISNULL` and string lengths. If your column is `VARCHAR(3)` and you use `ISNULL(column, 'Unknown')`, the result will be truncated to `'Unk'`. `COALESCE` would return the full `'Unknown'`.

### 4. The Interview "Pivot"
* **Triggers:** "How do you handle missing data in your queries?", "What is the difference between COALESCE and ISNULL?", or "Tell me about a time you had to optimize a SQL query for accuracy."
* **The Connection:** This topic allows me to pivot from basic query writing to a discussion on **Defensive Programming** and **Database Portability**. It proves I understand the nuances of how different database engines process data types and that I write code that is both robust and maintainable across different environments.

> [!CAUTION]
> In SQL Server, `COALESCE` is translated into a `CASE` expression. If the arguments include subqueries, `COALESCE` might execute those subqueries multiple times, whereas `ISNULL` only executes the subquery once. Always check the execution plan when using subqueries as arguments.