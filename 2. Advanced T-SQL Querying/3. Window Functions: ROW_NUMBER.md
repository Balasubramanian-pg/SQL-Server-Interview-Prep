# 3. Window Functions: ROW_NUMBER

### 1. The Anchor
* **One-Sentence Pitch:** `ROW_NUMBER()` is a window function that assigns a unique, sequential integer to each row within a result set partition, starting at 1 for the first row of each partition.
* **Category:** Technical Skill / SQL Development & Data Analysis

### 2. The Mechanics
* **Key Detail A: The OVER Clause and Determinism:** The function requires an `OVER` clause, typically containing an `ORDER BY` sub-clause. Unlike `RANK()` or `DENSE_RANK()`, `ROW_NUMBER()` is strictly sequential; if two rows have identical values in the ordering column, `ROW_NUMBER()` will still assign them distinct, consecutive integers (though the specific assignment between ties may be non-deterministic unless a tie-breaking column is provided).
* **Key Detail B: Partitioning Logic:** By using `PARTITION BY`, the sequential counter resets for every unique group. This allows for intra-group calculations, such as finding the "first" or "latest" record for every individual entity in a dataset.
* **The Logic:** `ROW_NUMBER()` solves the problem of row identification and selection in non-unique datasets. It is the industry-standard method for deduplication and "Top N" queries because it guarantees a unique index for every row, regardless of whether the underlying data contains ties.

> [!IMPORTANT]
> While `ROW_NUMBER()` is excellent for pagination and deduplication, it should be used with caution in tie-breaking scenarios. If business logic requires all tied rows to receive the same rank, `RANK()` or `DENSE_RANK()` should be used instead.

### 3. The Evidence
* **Context (CAR/STAR):** A production database migration resulted in duplicate event logs where the same `event_id` was ingested multiple times due to a retry logic error in the ETL pipeline.
* **Action:** I authored a cleanup script utilizing a Common Table Expression (CTE). I applied `ROW_NUMBER() OVER (PARTITION BY event_id ORDER BY ingested_at DESC)` to the dataset. This allowed me to flag the most recent entry as `1` and all subsequent duplicates as `> 1`.
* **Result:** I successfully identified and removed 1.2 million redundant rows (approximately 8% of the table volume), improving query performance by 15% and ensuring downstream reporting reflected accurate event counts.

> [!TIP]
> When using `ROW_NUMBER()` for deduplication, always include a secondary tie-breaker in your `ORDER BY` clause (like a primary key or a high-precision timestamp) to ensure your results are reproducible across different execution runs.

### 4. The Interview "Pivot"
* **Triggers:** "How do you handle duplicate records in a SQL table?", "Explain the difference between various ranking functions," or "How would you find the most recent order for every customer in a sales table?"
* **The Connection:** This topic proves I possess advanced SQL capabilities beyond basic CRUD operations. It demonstrates that I understand how to manipulate data at scale, ensure data integrity, and perform complex analytical tasks that are essential for data engineering and high-level backend development.

> [!NOTE]
> In many distributed SQL engines (like BigQuery or Snowflake), `ROW_NUMBER()` is more computationally efficient than `DISTINCT` when you need to select specific versions of a record rather than just unique values across all columns.