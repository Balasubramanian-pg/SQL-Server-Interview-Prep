# 6. Included Columns (Covering Indexes)

Canonical documentation for [6. Included Columns (Covering Indexes)](4. Indexing Deep Dive/6. Included Columns (Covering Indexes).md). This document defines concepts, terminology, and standard usage.

## Purpose
The primary purpose of included columns is to facilitate "covering indexes," which allow a database engine to satisfy a query's data requirements entirely from the index itself. By storing non-key data at the leaf level of an index, the system avoids the expensive operation of navigating back to the primary data storage (the base table or clustered index) to retrieve additional fields. This addresses the performance bottleneck caused by random I/O during "lookups" or "bookmark fetches."

> [!NOTE]
> This documentation is intended to be implementation-agnostic and authoritative, focusing on the architectural advantages of non-key index members.

## Scope
This documentation covers the theoretical framework, structural implications, and performance characteristics of adding non-key columns to secondary indexes.

> [!IMPORTANT]
> **In scope:**
> * Structural differences between key and non-key columns.
> * The mechanism of "Index-Only" access paths.
> * Impact on storage and maintenance overhead.
> * Criteria for selecting included columns.

> [!WARNING]
> **Out of scope:**
> * Specific vendor-specific syntax (e.g., T-SQL `INCLUDE` vs. PostgreSQL `INCLUDE`).
> * Implementation details of specific storage engines (e.g., InnoDB vs. WiredTiger).
> * Columnar storage formats (this document assumes B-Tree or similar structures).

## Definitions
| Term | Definition |
|------|------------|
| Covering Index | An index that contains all the columns required by a specific query, allowing the engine to return results without accessing the base table. |
| Included Column | A non-key column stored only at the leaf level of an index; it does not participate in the index's logical ordering. |
| Key Column | A column used to define the logical sort order and structure of the index B-Tree. |
| Leaf Level | The bottom-most level of an index structure where the actual data (or pointers to data) resides. |
| Lookup / Seek | The process of jumping from an index entry to the corresponding row in the base table to retrieve missing data. |

## Core Concepts
The fundamental idea behind included columns is the separation of **search criteria** from **payload delivery**.

In a standard index, all columns are "key columns." They define the hierarchy of the B-Tree. Every column added as a key increases the size of the index at every level (root, intermediate, and leaf) and affects the sort order.

Included columns, however, exist only at the leaf level. They do not affect the physical or logical sorting of the index. This allows the index to remain narrow and efficient for searching (the "seek"), while providing a "payload" of extra data once the correct leaf page is reached.

> [!TIP]
> Think of a covering index like a phone book. If you only need a person's name (the key) and their phone number (the included column), you never need to visit their physical house (the base table) to get the information. The phone book "covers" your request.

## Standard Model
The standard model for implementing included columns involves three primary components:

1.  **The Search Key:** One or more columns used in `WHERE`, `JOIN`, or `ORDER BY` clauses. These are defined as key columns to ensure the engine can quickly locate the relevant range of data.
2.  **The Payload:** Columns required by the `SELECT` list or other parts of the query that are not used for filtering or sorting. These are defined as included columns.
3.  **The Access Path:** When a query is executed, the optimizer identifies that the index contains 100% of the required data. It chooses an "Index-Only Scan" or "Index Seek," bypassing the base table entirely.

## Common Patterns
*   **High-Frequency Narrow Queries:** For queries that run thousands of times per second and select only 2-3 columns, including those columns in the index can reduce I/O by orders of magnitude.
*   **Reducing Contention:** By accessing only the index, a system may avoid certain types of locks on the base table, increasing concurrency.
*   **Handling Non-Indexable Data Types:** Some data types that cannot be used as index keys (due to size or type constraints) can sometimes be stored as included columns to provide coverage.

## Anti-Patterns
*   **The "Table Mirror" Pattern:** Including so many columns that the index becomes a near-duplicate of the base table. This doubles storage requirements and significantly slows down `INSERT`, `UPDATE`, and `DELETE` operations.
*   **Including Volatile Columns:** Adding columns that change frequently as included columns. Every time the value in the base table changes, the index must also be updated, leading to index fragmentation and write-amplification.
*   **Ignoring Key Order:** Using included columns for data that is frequently used in `ORDER BY` or `GROUP BY` clauses. Since included columns are not sorted, the engine will still have to perform a manual sort operation.

> [!CAUTION]
> Avoid adding columns to an index simply because they appear in a query. Every included column adds a maintenance tax to every write operation on that table.

## Edge Cases
*   **Unique Constraints:** In many systems, included columns do not contribute to the uniqueness of an index. A unique index on `Column A` with `Column B` included only enforces uniqueness on `Column A`.
*   **Data Type Limits:** Some systems impose maximum byte-size limits on index keys but allow much larger limits for the total leaf-level row size (including included columns).
*   **Filter Predicates:** When combined with filtered indexes (indexes with a `WHERE` clause), included columns can create extremely small, highly specialized "covering" structures for specific subsets of data.

## Related Topics
*   **B-Tree Structures:** The underlying data structure that supports most implementations of included columns.
*   **Query Optimization:** The process by which the database engine decides whether to use a covering index.
*   **Index Fragmentation:** How frequent updates to included columns can degrade index performance over time.
*   **SARGability:** The ability of a query to effectively use an index seek based on the key columns.

## Change Log
| Version | Date | Description |
|---------|------|-------------|
| 1.0 | 2026-02-13 | Initial AI-generated canonical documentation |